<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barista Academy</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0c0a09;--surface:#1c1917;--surface2:#292524;--surface3:#3a3530;--border:#44403c;--cream:#fef3c7;--brown:#d97706;--brown-light:#f59e0b;--brown-dark:#92400e;--text:#fafaf9;--text-muted:#a8a29e;--green:#22c55e;--red:#ef4444;--blue:#3b82f6;--purple:#a855f7;--nav-w:72px}
body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text);line-height:1.6}
a{color:var(--brown-light);text-decoration:none}
img{max-width:100%;border-radius:12px;display:block}

/* NAV */
nav{position:fixed;top:0;left:0;width:var(--nav-w);height:100vh;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;align-items:center;padding:16px 0;gap:4px;z-index:500;overflow-y:auto}
nav .logo{font-size:28px;margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid var(--border);width:100%;text-align:center}
nav a.nl{width:48px;height:48px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--text-muted);transition:all .2s;text-decoration:none;position:relative}
nav a.nl:hover{background:var(--surface2);color:var(--text)}
nav a.nl.active{background:var(--brown);color:#000}
nav a.nl .tip{position:absolute;left:60px;background:var(--surface2);color:var(--text);padding:6px 12px;border-radius:8px;font-size:12px;white-space:nowrap;opacity:0;pointer-events:none;transition:opacity .2s;z-index:600}
nav a.nl:hover .tip{opacity:1}

main{margin-left:var(--nav-w);min-height:100vh}
.sec{padding:60px 40px 80px;max-width:1200px;margin:0 auto}
.badge{display:inline-block;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:2px;color:var(--brown-light);margin-bottom:8px}
.sec h2{font-family:'Playfair Display',serif;font-size:clamp(28px,4vw,42px);margin-bottom:8px;color:var(--cream)}
.sec .sub{color:var(--text-muted);font-size:15px;margin-bottom:40px;max-width:600px}
.sec h3{font-family:'Playfair Display',serif;color:var(--cream);margin:40px 0 20px;font-size:24px}

/* HERO */
.hero{min-height:100vh;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;padding:40px 20px;position:relative;overflow:hidden}
.hero::before{content:'';position:absolute;inset:-50%;background:radial-gradient(ellipse at center,rgba(217,119,6,.08) 0%,transparent 60%);animation:pulse 8s ease-in-out infinite}
@keyframes pulse{0%,100%{transform:scale(1);opacity:.5}50%{transform:scale(1.1);opacity:1}}
.hero h1{font-family:'Playfair Display',serif;font-size:clamp(40px,7vw,80px);font-weight:700;letter-spacing:-2px;line-height:1.1;position:relative;z-index:1;background:linear-gradient(135deg,var(--cream),var(--brown-light));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
.hero p{font-size:17px;color:var(--text-muted);margin-top:12px;max-width:520px;position:relative;z-index:1;font-weight:300}
.hgrid{display:grid;grid-template-columns:repeat(auto-fit,minmax(130px,1fr));gap:12px;margin-top:40px;width:100%;max-width:800px;position:relative;z-index:1}
.hc{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:18px 10px;text-align:center;cursor:pointer;transition:all .3s;text-decoration:none;color:var(--text)}
.hc:hover{border-color:var(--brown);transform:translateY(-2px)}
.hc span{font-size:28px;display:block;margin-bottom:6px}
.hc small{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:1px;color:var(--text-muted)}

/* CARDS */
.vgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
.vcard{background:var(--surface);border:1px solid var(--border);border-radius:20px;overflow:hidden;transition:all .3s}
.vcard:hover{border-color:var(--brown);transform:translateY(-2px)}
.vcard-img{width:100%;aspect-ratio:16/10;object-fit:cover;border-radius:0}
.vcard-vis{padding:32px;display:flex;align-items:center;justify-content:center;min-height:200px;position:relative}
.vcard-body{padding:20px 24px 24px}
.vcard-body h4{font-family:'Playfair Display',serif;font-size:18px;margin-bottom:6px}
.vcard-body p{font-size:13px;color:var(--text-muted);line-height:1.6}
.vcard-status{display:inline-block;padding:4px 12px;border-radius:100px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.st-good{background:#052e16;color:#4ade80}
.st-bad{background:#450a0a;color:#f87171}
.st-warn{background:#451a03;color:#fbbf24}
.st-info{background:#0c1a3d;color:#60a5fa}

/* PHOTO COMPARE */
.photo-compare{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin:20px 0}
.pc-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;text-align:center}
.pc-card img{width:100%;aspect-ratio:4/3;object-fit:cover;border-radius:0}
.pc-card .pc-body{padding:16px}
.pc-card .pc-body h4{font-size:16px;margin-bottom:4px}
.pc-card .pc-body p{font-size:13px;color:var(--text-muted)}

/* COMPARE STRIP */
.compare{display:grid;grid-template-columns:repeat(3,1fr);gap:0;border-radius:20px;overflow:hidden;border:1px solid var(--border)}
.compare-item{padding:32px 20px;text-align:center;position:relative}
.compare-item svg{margin:0 auto 16px;display:block}
.compare-item h4{font-size:15px;margin-bottom:4px}
.compare-item p{font-size:12px;color:var(--text-muted)}

/* THERMOMETER */
.thermo-wrap{display:flex;align-items:stretch;gap:40px;padding:20px;flex-wrap:wrap;justify-content:center}
.thermo-zones{flex:1;display:flex;flex-direction:column;justify-content:space-between;min-width:200px;max-width:400px}
.tz{padding:16px;border-radius:12px;display:flex;align-items:center;gap:12px}
.tz-icon{font-size:32px}

/* ANIM */
@keyframes bubble1{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-8px) scale(1.1)}}
@keyframes bubble2{0%,100%{transform:translateY(0) scale(1)}50%{transform:translateY(-12px) scale(.9)}}
@keyframes bubble3{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes steam{0%{opacity:0;transform:translateY(0) scaleX(1)}50%{opacity:.6;transform:translateY(-15px) scaleX(1.3)}100%{opacity:0;transform:translateY(-30px) scaleX(.8)}}
@keyframes shimmer{0%{opacity:.3}50%{opacity:.7}100%{opacity:.3}}
.anim-bubble{animation:bubble1 2s ease-in-out infinite}
.anim-bubble2{animation:bubble2 2.5s ease-in-out infinite .3s}
.anim-bubble3{animation:bubble3 1.8s ease-in-out infinite .6s}
.steam-line{animation:steam 2s ease-out infinite}
.steam-line2{animation:steam 2.5s ease-out infinite .7s}
.steam-line3{animation:steam 2s ease-out infinite 1.4s}

/* DIAG */
.diag{background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden;margin-bottom:10px}
.diag-h{padding:16px 20px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;font-weight:600;font-size:15px;transition:background .2s}
.diag-h:hover{background:var(--surface2)}
.diag .arr{transition:transform .3s;color:var(--text-muted)}
.diag.open .arr{transform:rotate(180deg)}
.diag-b{max-height:0;overflow:hidden;transition:max-height .4s}
.diag.open .diag-b{max-height:800px}
.diag-bi{padding:0 20px 20px;font-size:14px;color:var(--text-muted);line-height:1.8}
.diag-bi strong{color:var(--cream)}

/* TABLE */
.rtable{width:100%;border-collapse:collapse;margin:20px 0}
.rtable th{text-align:left;padding:12px 16px;background:var(--surface2);color:var(--cream);font-size:12px;font-weight:600;text-transform:uppercase;letter-spacing:1px}
.rtable th:first-child{border-radius:10px 0 0 0}.rtable th:last-child{border-radius:0 10px 0 0}
.rtable td{padding:12px 16px;border-bottom:1px solid var(--surface2);font-size:14px;color:var(--text-muted)}
.rtable tr:hover td{background:var(--surface);color:var(--text)}

/* STEPS */
.steps{counter-reset:s}
.step{counter-increment:s;display:flex;gap:16px;padding:16px 0;border-bottom:1px solid var(--surface2);font-size:14px;color:var(--text-muted);line-height:1.7}
.step:last-child{border-bottom:none}
.step::before{content:counter(s);background:var(--brown);color:#000;min-width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;flex-shrink:0}

/* VIDEOS */
.vid-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px}
.vid-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;overflow:hidden}
.vid-card iframe{width:100%;aspect-ratio:16/9;border:none;display:block}
.vid-card .vb{padding:16px}
.vid-card .vt{font-weight:600;font-size:15px;margin-bottom:4px}
.vid-card .vd{font-size:13px;color:var(--text-muted)}

/* TOOLS */
.tbox{background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:32px;margin-bottom:24px}
.tbox h3{margin:0 0 16px}
.irow{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin:12px 0}
.ifield{background:var(--surface2);border:1px solid var(--border);color:var(--text);padding:10px 16px;border-radius:10px;font-size:16px;font-family:inherit;width:120px;text-align:center}
.ifield:focus{outline:none;border-color:var(--brown)}
.ilabel{font-size:13px;color:var(--text-muted);font-weight:500}
.btn{background:var(--brown);color:#000;border:none;padding:12px 24px;border-radius:10px;font-size:14px;font-weight:600;cursor:pointer;font-family:inherit;transition:all .2s}
.btn:hover{background:var(--brown-light)}
.btn-o{background:none;border:1px solid var(--border);color:var(--text);padding:10px 20px;border-radius:10px;font-size:14px;cursor:pointer;font-family:inherit;transition:all .2s}
.btn-o:hover{border-color:var(--brown);color:var(--brown-light)}
.timer-d{font-size:64px;font-weight:700;color:var(--cream);text-align:center;margin:20px 0;letter-spacing:4px}
.rbox{background:var(--surface2);border-radius:12px;padding:20px;margin-top:16px;text-align:center}
.rbox .big{font-size:36px;font-weight:700;color:var(--cream)}
.rbox .lbl{font-size:13px;color:var(--text-muted);margin-top:4px}

/* FILTER */
.fbar{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px}
/* RECIPE GRID */
.rgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:20px}
.rcard{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:24px;cursor:pointer;transition:all .3s}
.rcard:hover{border-color:var(--brown);transform:translateY(-2px)}

/* MODAL */
.mo{position:fixed;inset:0;background:rgba(0,0,0,.8);backdrop-filter:blur(10px);z-index:1000;display:none;align-items:center;justify-content:center;padding:20px}
.mo.active{display:flex}
.md{background:var(--surface);border:1px solid var(--border);border-radius:24px;max-width:640px;width:100%;max-height:85vh;overflow-y:auto;padding:40px;position:relative}
.md-close{position:absolute;top:16px;right:16px;background:var(--surface2);border:none;color:var(--text-muted);width:36px;height:36px;border-radius:50%;font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.md-close:hover{background:var(--border);color:var(--text)}
.md::-webkit-scrollbar{width:6px}.md::-webkit-scrollbar-thumb{background:var(--border);border-radius:3px}
.igrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:16px 0}
.ib{background:var(--surface2);padding:14px;border-radius:12px;text-align:center}
.ib .l{font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px}
.ib .v{font-size:16px;font-weight:600;color:var(--cream);margin-top:2px}
.ratio-bar{display:flex;height:32px;border-radius:8px;overflow:hidden;margin:12px 0;font-size:11px;font-weight:600}
.ratio-bar div{display:flex;align-items:center;justify-content:center;color:#000}
.ingr{display:grid;grid-template-columns:1fr 1fr;gap:8px;list-style:none}
.ingr li{background:var(--surface2);padding:10px 14px;border-radius:10px;font-size:13px;color:var(--text-muted)}

/* GLOSSARY */
.gloss{columns:2;column-gap:24px}
.gl-item{break-inside:avoid;padding:12px 0;border-bottom:1px solid var(--surface2)}
.gl-item dt{font-weight:600;color:var(--cream);font-size:15px}
.gl-item dd{font-size:13px;color:var(--text-muted);margin-top:2px}

/* NOTES */
.notes-a{width:100%;min-height:200px;background:var(--surface2);border:1px solid var(--border);border-radius:12px;padding:16px;color:var(--text);font-family:inherit;font-size:14px;resize:vertical}
.notes-a:focus{outline:none;border-color:var(--brown)}

/* CHECKLIST */
.cklist{list-style:none}
.cklist li{padding:10px 0;border-bottom:1px solid var(--surface2);display:flex;align-items:center;gap:12px;font-size:14px;color:var(--text-muted);cursor:pointer}
.cklist li:hover{color:var(--text)}
.cklist li.done{text-decoration:line-through;opacity:.5}
.ckbox{width:22px;height:22px;border:2px solid var(--border);border-radius:6px;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .2s}
.cklist li.done .ckbox{background:var(--green);border-color:var(--green);color:#000}

/* LATTE ART */
.lp-card{background:var(--surface);border:1px solid var(--border);border-radius:20px;overflow:hidden;margin-bottom:24px}
.lp-header{display:flex;align-items:center;gap:20px;padding:24px 28px;flex-wrap:wrap}
.lp-header img{width:160px;height:160px;object-fit:cover;border-radius:12px;flex-shrink:0}
.lp-content{padding:0 28px 28px}
.tag{display:inline-block;background:var(--surface2);color:var(--text-muted);padding:4px 12px;border-radius:100px;font-size:12px;margin:2px}

/* TIP BOX */
.tip-box{background:var(--surface2);border-left:4px solid var(--brown);border-radius:0 12px 12px 0;padding:16px 20px;margin:16px 0;font-size:13px;color:var(--text-muted);line-height:1.7}
.tip-box strong{color:var(--cream)}

footer{text-align:center;padding:40px 20px;color:var(--text-muted);font-size:13px;border-top:1px solid var(--surface2);margin-left:var(--nav-w)}

@media(max-width:768px){
  nav{top:auto;bottom:0;left:0;width:100%;height:60px;flex-direction:row;padding:0 8px;overflow-x:auto;border-right:none;border-top:1px solid var(--border)}
  nav .logo{display:none}
  nav a.nl{width:40px;height:40px;font-size:18px;flex-shrink:0}
  nav a.nl .tip{display:none}
  main{margin-left:0;margin-bottom:60px}footer{margin-left:0}
  .sec{padding:40px 16px 60px}
  .hero{min-height:calc(100vh - 60px)}
  .hgrid{grid-template-columns:repeat(2,1fr)}
  .vgrid,.rgrid,.vid-grid,.photo-compare{grid-template-columns:1fr}
  .compare{grid-template-columns:1fr}
  .thermo-wrap{flex-direction:column;align-items:center}
  .igrid,.ingr{grid-template-columns:1fr}
  .gloss{columns:1}
  .lp-header{flex-direction:column;align-items:flex-start}
  .lp-header img{width:100%;height:200px}
}
</style></head>
<body>

<nav id="nav"></nav>
<main>
  <section class="hero" id="accueil">
    <div style="font-size:72px;position:relative;z-index:1">&#9749;</div>
    <h1>Barista Academy</h1>
    <p>Ton guide visuel pour progresser chaque jour derriere la machine.</p>
    <div class="hgrid" id="heroGrid"></div>
  </section>

  <!-- MOULIN -->
  <section class="sec" id="moulin">
    <div class="badge">Moulin & Calibrage</div>
    <h2>La mouture, c'est 80% du resultat</h2>
    <p class="sub">Avant de toucher a quoi que ce soit d'autre, apprends a reconnaitre ta mouture visuellement.</p>
    <div id="grindPhotos"></div>
    <h3>&#127916; Comprendre la mouture en video</h3>
    <div class="vid-grid">
      <div class="vid-card"><iframe src="https://www.youtube.com/embed/er2voEn8ZDU" allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" allowfullscreen loading="lazy"></iframe><div class="vb"><div class="vt">Understanding Espresso: Grind Size</div><div class="vd">James Hoffmann — L'impact de la mouture sur ton espresso</div></div></div>
    </div>
    <h3>Tableau de reference rapide</h3>
    <div id="grindTable"></div>
    <h3>Mon cafe coule mal — que faire ?</h3>
    <div id="grindCompare"></div>
    <div class="tip-box">&#128161; <strong>Mon astuce apres 2 mois :</strong> Chaque matin, tire un premier espresso et REGARDE-LE. S'il coule comme de l'eau = mouture trop grosse. S'il goutte au ralenti = trop fin. Ajuste d'un cran a la fois.</div>
  </section>

  <!-- EXTRACTION -->
  <section class="sec" id="extraction">
    <div class="badge">Extraction</div>
    <h2>A quoi ressemble un BON espresso ?</h2>
    <p class="sub">Voici exactement ce que tu dois voir — compare avec tes vrais shots.</p>
    <div class="photo-compare" id="extractPhotos"></div>
    <h3>&#127916; Apprendre a dialer son espresso</h3>
    <div class="vid-grid">
      <div class="vid-card"><iframe src="https://www.youtube.com/embed/d0g8umpINFQ" allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" allowfullscreen loading="lazy"></iframe><div class="vb"><div class="vt">How I Dial In Espresso</div><div class="vd">James Hoffmann — Methode complete pour trouver le shot parfait</div></div></div>
      <div class="vid-card"><iframe src="https://www.youtube.com/embed/aTFsBqhpLes" allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" allowfullscreen loading="lazy"></iframe><div class="vb"><div class="vt">Understanding Espresso: Dose</div><div class="vd">James Hoffmann — Combien de cafe mettre dans le panier</div></div></div>
      <div class="vid-card"><iframe src="https://www.youtube.com/embed/F4wrUP4c5P4" allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" allowfullscreen loading="lazy"></iframe><div class="vb"><div class="vt">Understanding Espresso: Ratio</div><div class="vd">James Hoffmann — Le ratio dose/rendement explique</div></div></div>
    </div>
    <h3>Ma methode de Dialing-In</h3>
    <div class="tip-box">&#128161; <strong>Le truc que j'aurais voulu savoir :</strong> Ne change qu'UNE variable a la fois. Si tu changes la mouture ET la dose en meme temps, tu ne sauras jamais ce qui a fonctionne.</div>
    <div id="dialSteps" class="steps"></div>
  </section>

  <!-- LAIT -->
  <section class="sec" id="lait">
    <div class="badge">Techniques du lait</div>
    <h2>Le lait, c'est ce qui m'a pris le plus de temps</h2>
    <p class="sub">Voici les erreurs que j'ai faites et comment les reconnaitre visuellement.</p>

    <h3>&#128064; Reconnaitre la texture : bon vs mauvais</h3>
    <div id="milkTexture"></div>

    <h3>&#127916; LE tutoriel de reference pour le lait</h3>
    <div class="vid-grid">
      <div class="vid-card"><iframe src="https://www.youtube.com/embed/xb3IxAr4RCo" allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" allowfullscreen loading="lazy"></iframe><div class="vb"><div class="vt">Understanding Espresso: Complete Process</div><div class="vd">James Hoffmann — Processus complet incluant le texturage du lait</div></div></div>
    </div>

    <h3>&#127777; Le thermometre du barista</h3>
    <div id="milkThermo"></div>

    <h3>&#9995; Comment tenir le pichet</h3>
    <div id="milkGrip"></div>

    <h3>&#128168; Position de la buse vapeur</h3>
    <div id="milkWand"></div>

    <h3>Les 4 phases du texturage</h3>
    <div id="milkPhases"></div>
    <div class="tip-box">&#128161; <strong>Le son te dit tout :</strong> "Tch-tch-tch" = air qui entre (stretching, c'est bien). Bruit de papier dechire = buse trop haute. Silence = buse trop profonde. Grondement sourd = vortex (spinning, c'est bien).</div>

    <h3>&#128204; Temperatures par type de lait</h3>
    <div id="milkTable"></div>
  </section>

  <!-- LATTE ART -->
  <section class="sec" id="latteart">
    <div class="badge">Latte Art</div>
    <h2>Mes premiers patterns — etape par etape</h2>
    <p class="sub">Chaque pattern avec LA video qui m'a aide, les etapes, et une photo de reference pour comparer.</p>

    <h3>Avant de commencer : la hauteur de versement</h3>
    <div id="latteHeight"></div>

    <div id="lattePatterns"></div>
  </section>

  <!-- RECETTES -->
  <section class="sec" id="recettes">
    <div class="badge">Recettes</div>
    <h2>Toutes les recettes</h2>
    <p class="sub">21 cafes avec ratios visuels et etapes detaillees.</p>
    <div class="fbar" id="filterBar"></div>
    <div class="rgrid" id="recipesGrid"></div>
  </section>

  <!-- DIAGNOSTIC -->
  <section class="sec" id="diagnostic">
    <div class="badge">Diagnostic</div>
    <h2>Mon cafe est mauvais — pourquoi ?</h2>
    <p class="sub">Le guide que j'aurais voulu avoir mes premieres semaines.</p>
    <div id="diagVisual"></div>
    <h3>Problemes frequents (clique pour voir la solution)</h3>
    <div id="troubleshoot"></div>
  </section>

  <!-- OUTILS -->
  <section class="sec" id="outils">
    <div class="badge">Outils</div>
    <h2>Boite a outils</h2>
    <p class="sub">Timer, calculateur, checklist et carnet de notes.</p>
    <div id="toolsContent"></div>
  </section>

  <!-- GLOSSAIRE -->
  <section class="sec" id="glossaire">
    <div class="badge">Glossaire</div>
    <h2>Lexique du barista</h2>
    <div class="gloss" id="glossContent"></div>
  </section>
</main>

<div class="mo" id="mo"><div class="md" id="md"></div></div>
<footer>Barista Academy &mdash; Guide visuel pour baristas</footer>

<script>
// ===== PHOTOS =====
const P={
  heart:'https://images.unsplash.com/photo-1512568400610-62da28bc8a13?w=600&q=80',
  rosetta:'https://images.unsplash.com/photo-1523247140972-52cc3cdd2715?w=600&q=80',
  barista:'https://images.unsplash.com/photo-1529380996459-a5a4eeea810a?w=600&q=80',
  pouring:'https://images.unsplash.com/photo-1497636577773-f1231844b336?w=600&q=80',
  holding:'https://images.unsplash.com/photo-1520903920243-00d872a2d1c9?w=600&q=80',
  cappuccino:'https://images.unsplash.com/photo-1524671710025-d79530c2f957?w=600&q=80',
  heartCup:'https://images.unsplash.com/photo-1532258508286-bb57a8c96b8b?w=600&q=80',
  machine:'https://images.unsplash.com/photo-1582098763665-8477ab3c25fd?w=600&q=80',
  drip:'https://images.unsplash.com/photo-1519656919827-59c35dd3ce77?w=600&q=80',
  latte:'https://images.unsplash.com/photo-1517640033243-dc06bb716df5?w=600&q=80',
  lattePour:'https://images.unsplash.com/photo-1574914629377-e97c19438717?w=600&q=80',
  cafe:'https://images.unsplash.com/photo-1501082957694-70db7b6b62ff?w=600&q=80',
  v60:'https://images.unsplash.com/photo-1619109980753-cdf7d43068c1?w=600&q=80',
  tulip:'https://images.unsplash.com/photo-1648748006674-1536ed2d1de9?w=600&q=80'
};

// ===== SVG HELPERS =====
function svgPitcher(opts={}){
  const {tilt=0,milk='#fef3c7',fill=70,bubbles=false,bigBubbles=false,steam=false,shimmer=false}=opts;
  let bubblesHTML='';
  if(bigBubbles){
    bubblesHTML=`<circle cx="55" cy="${130-fill*0.8}" r="6" fill="none" stroke="#fff" stroke-width="1.5" opacity=".5" class="anim-bubble"/>
    <circle cx="75" cy="${140-fill*0.8}" r="8" fill="none" stroke="#fff" stroke-width="1.5" opacity=".4" class="anim-bubble2"/>
    <circle cx="65" cy="${120-fill*0.8}" r="5" fill="none" stroke="#fff" stroke-width="1.5" opacity=".5" class="anim-bubble3"/>`;
  }else if(bubbles){
    bubblesHTML=`<circle cx="58" cy="${135-fill*0.8}" r="2" fill="#fff" opacity=".3" class="anim-bubble"/>
    <circle cx="72" cy="${130-fill*0.8}" r="1.5" fill="#fff" opacity=".25" class="anim-bubble2"/>`;
  }
  let steamHTML='';
  if(steam){
    steamHTML=`<path d="M55,55 Q58,45 55,35" stroke="#fff" stroke-width="2" fill="none" opacity=".15" class="steam-line"/>
    <path d="M68,52 Q72,40 68,30" stroke="#fff" stroke-width="2" fill="none" opacity=".12" class="steam-line2"/>`;
  }
  let shimmerHTML='';
  if(shimmer){
    shimmerHTML=`<ellipse cx="65" cy="${130-fill*0.8-5}" rx="20" ry="2" fill="#fff" opacity=".15" style="animation:shimmer 3s ease-in-out infinite"/>`;
  }
  return `<svg viewBox="0 0 130 180" width="120" height="170" style="transform:rotate(${tilt}deg)">
    <path d="M35,60 L30,150 Q30,165 65,165 Q100,165 100,150 L95,60" fill="var(--surface2)" stroke="var(--border)" stroke-width="2"/>
    <path d="M100,70 Q120,70 118,110 Q116,145 100,150" fill="none" stroke="var(--border)" stroke-width="4" stroke-linecap="round"/>
    <path d="M35,60 Q25,55 20,50" fill="none" stroke="var(--border)" stroke-width="3" stroke-linecap="round"/>
    <clipPath id="pc${tilt}${fill}"><path d="M36,60 L31,150 Q31,164 65,164 Q99,164 99,150 L96,60 Z"/></clipPath>
    <rect x="30" y="${160-fill*1.05}" width="72" height="${fill*1.05+10}" fill="${milk}" opacity=".85" clip-path="url(#pc${tilt}${fill})"/>
    ${bubblesHTML}${steamHTML}${shimmerHTML}
    <path d="M35,60 Q65,55 95,60" fill="none" stroke="var(--border)" stroke-width="2"/>
  </svg>`;
}

function svgCup(opts={}){
  const {color='#78350f',crema='#c2854a'}=opts;
  return `<svg viewBox="0 0 120 100" width="110" height="95">
    <path d="M20,25 L25,80 Q25,90 60,90 Q95,90 95,80 L100,25" fill="${color}" stroke="var(--border)" stroke-width="1.5"/>
    <ellipse cx="60" cy="25" rx="40" ry="10" fill="${crema}"/>
    <path d="M100,35 Q115,35 115,55 Q115,72 100,72" fill="none" stroke="var(--border)" stroke-width="3" stroke-linecap="round"/>
  </svg>`;
}

function svgThermo(temp,color){
  const pct=Math.min(100,Math.max(0,(temp/100)*100));
  return `<svg viewBox="0 0 40 160" width="36" height="150">
    <rect x="12" y="10" width="16" height="120" rx="8" fill="var(--surface2)" stroke="var(--border)" stroke-width="1.5"/>
    <rect x="14" y="${130-pct*1.15}" width="12" height="${pct*1.15}" rx="6" fill="${color}"/>
    <circle cx="20" cy="140" r="14" fill="${color}" opacity=".9"/>
    <text x="20" y="145" text-anchor="middle" fill="#000" font-size="10" font-weight="700">${temp}°</text>
  </svg>`;
}

// ===== NAV =====
const secs=[
  {id:'accueil',icon:'&#9749;',l:'Accueil'},{id:'moulin',icon:'&#9881;',l:'Moulin'},
  {id:'extraction',icon:'&#128300;',l:'Extraction'},{id:'lait',icon:'&#129371;',l:'Lait'},
  {id:'latteart',icon:'&#127912;',l:'Latte Art'},{id:'recettes',icon:'&#128203;',l:'Recettes'},
  {id:'diagnostic',icon:'&#128269;',l:'Diagnostic'},{id:'outils',icon:'&#128736;',l:'Outils'},
  {id:'glossaire',icon:'&#128218;',l:'Glossaire'}
];
document.getElementById('nav').innerHTML='<div class="logo">&#9749;</div>'+secs.map(s=>`<a href="#${s.id}" class="nl" data-s="${s.id}">${s.icon}<span class="tip">${s.l}</span></a>`).join('');
document.getElementById('heroGrid').innerHTML=secs.slice(1).map(s=>`<a href="#${s.id}" class="hc"><span>${s.icon}</span><small>${s.l}</small></a>`).join('');
const obs=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){document.querySelectorAll('.nl').forEach(l=>l.classList.remove('active'));const l=document.querySelector(`.nl[data-s="${e.target.id}"]`);if(l)l.classList.add('active')}})},{threshold:.3,rootMargin:'-20% 0px -60% 0px'});
secs.forEach(s=>{const el=document.getElementById(s.id);if(el)obs.observe(el)});

// ===== MOULIN =====
document.getElementById('grindPhotos').innerHTML=`
<div class="photo-compare">
  <div class="pc-card">
    <img src="${P.drip}" alt="Espresso qui coule" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-good">Mouture espresso</div>
      <h4>Fin comme du sucre en poudre</h4>
      <p>L'eau doit mettre 25-30s a traverser. Le shot coule comme du miel.</p>
    </div>
  </div>
  <div class="pc-card">
    <img src="${P.v60}" alt="V60 pour over" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-info">Mouture filtre</div>
      <h4>Moyen comme du sable</h4>
      <p>Pour V60, Chemex, filtre. Plus gros que l'espresso, l'eau passe par gravite.</p>
    </div>
  </div>
  <div class="pc-card">
    <img src="${P.cafe}" alt="Cafe dans la tasse" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-warn">Mouture french press</div>
      <h4>Gros comme du gros sel</h4>
      <p>Pour French Press, Cold Brew. Si c'est trop fin, le cafe sera amer et boueux.</p>
    </div>
  </div>
</div>`;

const gRef=[
  {m:'Espresso',g:'Tres fin',dose:'18g',ratio:'1:2',time:'25-30s',temp:'93°C'},
  {m:'Moka',g:'Fin',dose:'15-20g',ratio:'1:7',time:'3-5 min',temp:'100°C'},
  {m:'AeroPress',g:'Fin-moyen',dose:'15g',ratio:'1:13',time:'1-2 min',temp:'85°C'},
  {m:'V60',g:'Moyen-fin',dose:'15g',ratio:'1:16',time:'3-4 min',temp:'93°C'},
  {m:'Chemex',g:'Moyen',dose:'30g',ratio:'1:16',time:'4-5 min',temp:'93°C'},
  {m:'French Press',g:'Gros',dose:'30g',ratio:'1:15',time:'4 min',temp:'93°C'},
  {m:'Cold Brew',g:'Tres gros',dose:'100g',ratio:'1:8',time:'12-24h',temp:'Froid'}
];
document.getElementById('grindTable').innerHTML='<div style="overflow-x:auto"><table class="rtable"><thead><tr><th>Methode</th><th>Mouture</th><th>Dose</th><th>Ratio</th><th>Temps</th><th>Temp</th></tr></thead><tbody>'+gRef.map(r=>`<tr><td><strong style="color:var(--text)">${r.m}</strong></td><td>${r.g}</td><td>${r.dose}</td><td>${r.ratio}</td><td>${r.time}</td><td>${r.temp}</td></tr>`).join('')+'</tbody></table></div>';

document.getElementById('grindCompare').innerHTML=`
<div class="compare" style="margin-top:20px">
  <div class="compare-item" style="background:#450a0a">
    ${svgCup({color:'#d4a574',crema:'#e8c99b'})}
    <div class="vcard-status st-bad">Trop rapide</div>
    <h4 style="color:#f87171">Mouture trop grosse</h4>
    <p>Cafe clair et acide. Crema fine et pale.</p>
    <p style="margin-top:8px;color:var(--cream);font-weight:600">&#8594; Serre le moulin (plus fin)</p>
  </div>
  <div class="compare-item" style="background:#052e16">
    ${svgCup({color:'#5c3a1e',crema:'#b8864a'})}
    <div class="vcard-status st-good">25-30 secondes</div>
    <h4 style="color:#4ade80">Mouture parfaite</h4>
    <p>Coule comme du miel. Crema epaisse, noisette.</p>
    <p style="margin-top:8px;color:var(--cream);font-weight:600">&#10003; Touche a rien !</p>
  </div>
  <div class="compare-item" style="background:#451a03">
    ${svgCup({color:'#2c1810',crema:'#4a2a18'})}
    <div class="vcard-status st-warn">Trop lent</div>
    <h4 style="color:#fbbf24">Mouture trop fine</h4>
    <p>Goutte-a-goutte, tres fonce et amer.</p>
    <p style="margin-top:8px;color:var(--cream);font-weight:600">&#8594; Desserre le moulin (plus gros)</p>
  </div>
</div>`;

// ===== EXTRACTION =====
document.getElementById('extractPhotos').innerHTML=`
  <div class="pc-card">
    <img src="${P.drip}" alt="Espresso extraction" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-good">Bon shot</div>
      <h4>Crema noisette, tiger stripes</h4>
      <p>Coule comme du miel chaud en 25-30s. Gout equilibre, sucre, complexe. C'est CA que tu vises.</p>
    </div>
  </div>
  <div class="pc-card">
    <img src="${P.machine}" alt="Espresso machine" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-bad">Sous-extrait</div>
      <h4>Trop rapide = acide</h4>
      <p>Coule en moins de 20s, clair, gout aigre. Solution : mouture plus fine ou dose plus importante.</p>
    </div>
  </div>
  <div class="pc-card">
    <img src="${P.latte}" alt="Espresso latte" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-warn">Sur-extrait</div>
      <h4>Trop lent = amer</h4>
      <p>Goutte-a-goutte apres 40s, tres fonce, sec en bouche. Solution : mouture plus grosse.</p>
    </div>
  </div>`;

const dial=['Dose : 18g dans le panier double (pese avec la balance).','Ratio cible : 1:2 → tu veux 36g de liquide dans la tasse.','Premier shot : lance le chrono. Vise 25-30 secondes.','Trop rapide (moins de 20s) ? Mouture plus fine, un cran.','Trop lent (plus de 35s) ? Mouture plus grosse, un cran.','GOUTE : acide = mouture plus fine. Amer = plus grosse. UNE variable a la fois.','Note tout dans le carnet (section Outils) : cafe, cran moulin, dose, temps, gout.','Refais apres chaque changement de sac de cafe.'];
document.getElementById('dialSteps').innerHTML=dial.map(s=>`<div class="step">${s}</div>`).join('');

// ===== LAIT =====
document.getElementById('milkTexture').innerHTML=`
<div class="compare" style="margin-bottom:30px">
  <div class="compare-item" style="background:#450a0a">
    <div style="width:120px;height:170px;margin:0 auto">${svgPitcher({fill:65,bigBubbles:true,milk:'#f5f0e0'})}</div>
    <div class="vcard-status st-bad">Mauvais</div>
    <h4 style="color:#f87171">Trop de mousse</h4>
    <p>Grosses bulles, mousse de cappuccino machine. Buse trop haute, trop d'air incorpore.</p>
  </div>
  <div class="compare-item" style="background:#052e16">
    <div style="width:120px;height:170px;margin:0 auto">${svgPitcher({fill:70,shimmer:true,milk:'#fef9ef'})}</div>
    <div class="vcard-status st-good">Parfait</div>
    <h4 style="color:#4ade80">Micro-mousse "wet paint"</h4>
    <p>Zero bulles visibles. Brillant comme de la peinture. Texture soyeuse et lourde.</p>
  </div>
  <div class="compare-item" style="background:#451a03">
    <div style="width:120px;height:170px;margin:0 auto">${svgPitcher({fill:60,milk:'#f0ead6'})}</div>
    <div class="vcard-status st-warn">Pas assez</div>
    <h4 style="color:#fbbf24">Lait plat</h4>
    <p>Lait chaud mais aucune texture. Buse trop profonde, pas d'air incorpore du tout.</p>
  </div>
</div>
<div class="photo-compare">
  <div class="pc-card">
    <img src="${P.pouring}" alt="Versement latte art" loading="lazy">
    <div class="pc-body">
      <h4>Bonne micro-mousse</h4>
      <p>Le lait coule de maniere fluide et dessine des motifs blancs nets sur le cafe.</p>
    </div>
  </div>
  <div class="pc-card">
    <img src="${P.cappuccino}" alt="Cappuccino" loading="lazy">
    <div class="pc-body">
      <h4>Mousse de cappuccino</h4>
      <p>Plus epaisse et aeree — stretching plus long (4-6s au lieu de 2-3s pour latte).</p>
    </div>
  </div>
</div>`;

// Thermometer
document.getElementById('milkThermo').innerHTML=`
<div class="thermo-wrap" style="background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:32px">
  <div style="display:flex;gap:16px;align-items:center;justify-content:center">
    ${svgThermo(40,'#60a5fa')}${svgThermo(55,'#fbbf24')}${svgThermo(65,'#4ade80')}${svgThermo(75,'#f87171')}
  </div>
  <div class="thermo-zones">
    <div class="tz" style="background:#450a0a;margin-bottom:8px">
      <div class="tz-icon">&#128293;</div>
      <div><strong style="color:#f87171">Au-dessus de 70°C = BRULE</strong><br><span style="font-size:13px;color:var(--text-muted)">Proteines detruites. Gout de brule. JETTE et recommence.</span></div>
    </div>
    <div class="tz" style="background:#052e16;margin-bottom:8px">
      <div class="tz-icon">&#10024;</div>
      <div><strong style="color:#4ade80">60-65°C = PARFAIT</strong><br><span style="font-size:13px;color:var(--text-muted)">Douceur max, latte art ideal. Tu peux toucher le pichet 2-3s max.</span></div>
    </div>
    <div class="tz" style="background:#451a03;margin-bottom:8px">
      <div class="tz-icon">&#9888;</div>
      <div><strong style="color:#fbbf24">50-60°C = TIEDE</strong><br><span style="font-size:13px;color:var(--text-muted)">Continue. Le lait n'est pas assez chaud.</span></div>
    </div>
    <div class="tz" style="background:#0c1a3d">
      <div class="tz-icon">&#10052;</div>
      <div><strong style="color:#60a5fa">En dessous de 50°C = FROID</strong><br><span style="font-size:13px;color:var(--text-muted)">Tu es encore dans la phase de stretching.</span></div>
    </div>
  </div>
</div>`;

// Pitcher grip
document.getElementById('milkGrip').innerHTML=`
<div class="vgrid">
  <div class="vcard">
    <div class="vcard-vis" style="background:var(--surface2)">
      <svg viewBox="0 0 200 200" width="180" height="180">
        <path d="M60,60 L55,160 Q55,175 100,175 Q145,175 145,160 L140,60" fill="var(--surface3)" stroke="var(--border)" stroke-width="2"/>
        <path d="M145,70 Q170,70 168,115 Q166,155 145,160" fill="none" stroke="var(--border)" stroke-width="4" stroke-linecap="round"/>
        <path d="M60,60 Q45,55 38,48" fill="none" stroke="var(--border)" stroke-width="3" stroke-linecap="round"/>
        <ellipse cx="158" cy="110" rx="22" ry="35" fill="var(--brown-dark)" opacity=".3" stroke="var(--brown)" stroke-width="1.5"/>
        <text x="158" y="115" text-anchor="middle" fill="var(--cream)" font-size="20">&#9995;</text>
      </svg>
    </div>
    <div class="vcard-body">
      <div class="vcard-status st-good">Bonne prise</div>
      <h4>Main sur la anse</h4>
      <p>Toute la main autour de la anse. Le pouce au-dessus. Tu sens la chaleur a travers le metal = ton thermometre gratuit.</p>
    </div>
  </div>
  <div class="vcard">
    <div class="vcard-vis" style="background:var(--surface2)">
      <svg viewBox="0 0 200 200" width="180" height="180">
        <g transform="rotate(-15, 100, 120)">
          <path d="M60,60 L55,160 Q55,175 100,175 Q145,175 145,160 L140,60" fill="var(--surface3)" stroke="var(--border)" stroke-width="2"/>
          <path d="M145,70 Q170,70 168,115 Q166,155 145,160" fill="none" stroke="var(--border)" stroke-width="4" stroke-linecap="round"/>
          <path d="M60,60 Q45,55 38,48" fill="none" stroke="var(--border)" stroke-width="3" stroke-linecap="round"/>
          <path d="M38,48 L20,30" stroke="var(--brown-light)" stroke-width="2" stroke-dasharray="4 3" opacity=".8"/>
          <circle cx="20" cy="28" r="4" fill="var(--brown-light)" opacity=".6"/>
        </g>
        <text x="20" y="20" fill="var(--brown-light)" font-size="11" font-weight="600">Bec verseur</text>
      </svg>
    </div>
    <div class="vcard-body">
      <div class="vcard-status st-info">Pour verser</div>
      <h4>Le poignet controle tout</h4>
      <p>Bras stable. Seul le poignet bouge pour incliner et controler le debit. C'est LA base du latte art.</p>
    </div>
  </div>
  <div class="vcard">
    <div class="vcard-vis" style="background:var(--surface2)">
      <svg viewBox="0 0 200 200" width="180" height="180">
        <rect x="50" y="50" width="80" height="120" rx="5" fill="var(--surface3)" stroke="var(--border)" stroke-width="2"/>
        <rect x="52" y="80" width="76" height="88" rx="3" fill="#fef3c7" opacity=".4"/>
        <ellipse cx="130" cy="120" rx="18" ry="25" fill="var(--brown-dark)" opacity=".3" stroke="var(--brown)" stroke-width="1.5"/>
        <text x="142" y="125" fill="var(--cream)" font-size="16">&#9995;</text>
        <text x="100" y="190" text-anchor="middle" fill="var(--text-muted)" font-size="11">Brulant = ~65°C &#10003;</text>
      </svg>
    </div>
    <div class="vcard-body">
      <div class="vcard-status st-warn">Temperature</div>
      <h4>Touche le metal</h4>
      <p>Main sur le cote du pichet. <strong>Chaud mais supportable 2-3s</strong> = 65°C parfait. Brule instantanement = trop chaud, arrete.</p>
    </div>
  </div>
</div>`;

// Wand
document.getElementById('milkWand').innerHTML=`
<div class="compare">
  <div class="compare-item" style="background:#450a0a">
    <svg viewBox="0 0 140 160" width="100" height="140">
      <rect x="20" y="40" width="100" height="100" rx="5" fill="var(--surface3)" stroke="var(--border)" stroke-width="1.5"/>
      <rect x="22" y="55" width="96" height="83" rx="3" fill="#fef3c7" opacity=".3"/>
      <rect x="60" y="10" width="6" height="48" rx="3" fill="#888"/>
      <circle cx="63" cy="58" r="4" fill="#888"/>
      <circle cx="50" cy="75" r="5" fill="none" stroke="#f87171" stroke-width="1.5" class="anim-bubble"/>
      <circle cx="75" cy="85" r="7" fill="none" stroke="#f87171" stroke-width="1.5" class="anim-bubble2"/>
      <text x="70" y="155" text-anchor="middle" fill="#f87171" font-size="10" font-weight="700">TROP HAUT</text>
    </svg>
    <div class="vcard-status st-bad">Grosses bulles</div>
    <p>Buse au-dessus = trop d'air</p>
  </div>
  <div class="compare-item" style="background:#052e16">
    <svg viewBox="0 0 140 160" width="100" height="140">
      <rect x="20" y="40" width="100" height="100" rx="5" fill="var(--surface3)" stroke="var(--border)" stroke-width="1.5"/>
      <rect x="22" y="55" width="96" height="83" rx="3" fill="#fef3c7" opacity=".3"/>
      <rect x="60" y="10" width="6" height="48" rx="3" fill="#888"/>
      <circle cx="63" cy="58" r="4" fill="#4ade80"/>
      <circle cx="50" cy="70" r="1" fill="#fff" opacity=".4" class="anim-bubble"/>
      <path d="M40,90 Q70,80 90,90 Q70,100 40,90Z" fill="none" stroke="#4ade80" stroke-width="1.5" stroke-dasharray="3 2" opacity=".5"/>
      <text x="70" y="155" text-anchor="middle" fill="#4ade80" font-size="10" font-weight="700">PARFAIT</text>
    </svg>
    <div class="vcard-status st-good">Micro-mousse</div>
    <p>Juste sous la surface + vortex</p>
  </div>
  <div class="compare-item" style="background:#451a03">
    <svg viewBox="0 0 140 160" width="100" height="140">
      <rect x="20" y="40" width="100" height="100" rx="5" fill="var(--surface3)" stroke="var(--border)" stroke-width="1.5"/>
      <rect x="22" y="55" width="96" height="83" rx="3" fill="#fef3c7" opacity=".3"/>
      <rect x="60" y="10" width="6" height="78" rx="3" fill="#888"/>
      <circle cx="63" cy="88" r="4" fill="#fbbf24"/>
      <path d="M50,60 Q52,53 50,45" stroke="#fbbf24" stroke-width="1.5" fill="none" opacity=".3" class="steam-line"/>
      <text x="70" y="155" text-anchor="middle" fill="#fbbf24" font-size="10" font-weight="700">TROP PROFOND</text>
    </svg>
    <div class="vcard-status st-warn">Aucune mousse</div>
    <p>Buse trop profonde = chauffe mais pas d'air</p>
  </div>
</div>`;

// Phases
const mPhases=[
  {icon:'&#128168;',t:'1. Stretching (2-4s)',d:'Buse JUSTE sous la surface. Tu entends "tch-tch-tch". L\'air entre dans le lait.',vis:svgPitcher({fill:50,bubbles:true,milk:'#fef9ef'})},
  {icon:'&#127744;',t:'2. Spinning',d:'Plonge la buse. Cree un vortex. Le lait tourne comme une tornade.',vis:svgPitcher({fill:65,shimmer:true,milk:'#fef9ef'})},
  {icon:'&#127777;',t:'3. Stop a 65°C',d:'Arrete quand le pichet est chaud mais supportable (2-3s max).',vis:svgPitcher({fill:70,steam:true,milk:'#fef3c7'})},
  {icon:'&#10024;',t:'4. Tap & Swirl',d:'Tape le pichet sur le comptoir + fais tourner. Ca doit ressembler a de la peinture.',vis:svgPitcher({fill:70,shimmer:true,milk:'#fefbf0'})}
];
document.getElementById('milkPhases').innerHTML='<div class="vgrid" style="grid-template-columns:repeat(auto-fill,minmax(240px,1fr))">'+mPhases.map(p=>`<div class="vcard"><div class="vcard-vis" style="background:var(--surface2);min-height:180px">${p.vis}</div><div class="vcard-body"><h4>${p.icon} ${p.t}</h4><p>${p.d}</p></div></div>`).join('')+'</div>';

// Milk table
const mTypes=[
  {t:'Lait entier &#129371;',temp:'60-65°C',m:'&#11088;&#11088;&#11088;',n:'LE standard. Riche, doux, parfait pour latte art.'},
  {t:'Avoine (Barista)',temp:'55-62°C',m:'&#11088;&#11088;&#11088;',n:'Meilleur vegetal. Oatly Barista recommande.'},
  {t:'Lait ecreme',temp:'60-65°C',m:'&#11088;&#11088;',n:'Mousse plus seche. Moins de douceur.'},
  {t:'Soja',temp:'55-60°C',m:'&#11088;',n:'Peut cailler si cafe acide. Verse lait SUR cafe.'},
  {t:'Amande',temp:'55-60°C',m:'&#11088;',n:'Mousse instable. Version Barista obligatoire.'},
  {t:'Coco',temp:'55-60°C',m:'&#9898;',n:'Tres difficile a mousser. Gout prononce.'}
];
document.getElementById('milkTable').innerHTML='<div style="overflow-x:auto"><table class="rtable"><thead><tr><th>Type</th><th>Temp. max</th><th>Mousse</th><th>Notes</th></tr></thead><tbody>'+mTypes.map(m=>`<tr><td><strong style="color:var(--text)">${m.t}</strong></td><td>${m.temp}</td><td>${m.m}</td><td>${m.n}</td></tr>`).join('')+'</tbody></table></div>';

// ===== LATTE ART =====
document.getElementById('latteHeight').innerHTML=`
<div class="compare" style="margin-bottom:30px">
  <div class="compare-item" style="background:var(--surface)">
    <svg viewBox="0 0 120 160" width="90" height="130">
      <path d="M25,90 L30,130 Q30,140 60,140 Q90,140 90,130 L95,90" fill="#5c3a1e" stroke="var(--border)" stroke-width="1.5"/>
      <ellipse cx="60" cy="90" rx="35" ry="10" fill="#b8864a"/>
      <g transform="rotate(-20,60,30)"><rect x="45" y="10" width="30" height="40" rx="4" fill="var(--surface3)" stroke="var(--border)" stroke-width="1"/></g>
      <line x1="48" y1="42" x2="60" y2="90" stroke="#fef3c7" stroke-width="2" opacity=".6" stroke-dasharray="4 3"/>
      <text x="108" y="70" fill="var(--brown-light)" font-size="9">~10cm</text>
    </svg>
    <div class="vcard-status st-info">Phase 1</div>
    <h4>HAUT : remplir la base</h4>
    <p>Le lait plonge sous la crema. Remplit sans motif.</p>
  </div>
  <div class="compare-item" style="background:var(--surface)">
    <svg viewBox="0 0 120 160" width="90" height="130">
      <path d="M25,90 L30,130 Q30,140 60,140 Q90,140 90,130 L95,90" fill="#5c3a1e" stroke="var(--border)" stroke-width="1.5"/>
      <ellipse cx="60" cy="90" rx="35" ry="10" fill="#b8864a"/>
      <ellipse cx="60" cy="90" rx="15" ry="5" fill="#fef3c7" opacity=".7"/>
      <g transform="rotate(-20,60,70)"><rect x="45" y="55" width="30" height="40" rx="4" fill="var(--surface3)" stroke="var(--border)" stroke-width="1"/></g>
      <line x1="48" y1="82" x2="55" y2="88" stroke="#fef3c7" stroke-width="4" opacity=".8"/>
      <text x="108" y="88" fill="var(--brown-light)" font-size="9">1-2cm</text>
    </svg>
    <div class="vcard-status st-good">Phase 2</div>
    <h4>BAS : dessiner le motif</h4>
    <p>Le blanc apparait. C'est ici que le pattern se forme.</p>
  </div>
  <div class="compare-item" style="background:var(--surface)">
    <svg viewBox="0 0 120 160" width="90" height="130">
      <path d="M25,90 L30,130 Q30,140 60,140 Q90,140 90,130 L95,90" fill="#5c3a1e" stroke="var(--border)" stroke-width="1.5"/>
      <ellipse cx="60" cy="90" rx="35" ry="10" fill="#b8864a"/>
      <ellipse cx="60" cy="88" rx="18" ry="8" fill="#fef3c7" opacity=".8"/>
      <line x1="60" y1="80" x2="60" y2="98" stroke="#b8864a" stroke-width="1.5"/>
      <g transform="rotate(-10,60,50)"><rect x="45" y="30" width="30" height="40" rx="4" fill="var(--surface3)" stroke="var(--border)" stroke-width="1"/></g>
    </svg>
    <div class="vcard-status st-warn">Phase 3</div>
    <h4>LEVER : couper le motif</h4>
    <p>Leve et traverse d'un trait fin = la pointe/tige.</p>
  </div>
</div>`;

const patterns=[
  {name:'Coeur',level:'Debutant',icon:'&#10084;',color:'#ef4444',
   photo:P.heart,
   video:'SiefJJv-Qho',videoTitle:'Latte Art Heart Tutorial',videoChannel:'European Coffee Trip',
   steps:['Remplis a 50% en versant HAUT (10cm) au centre de la tasse','Descends le pichet a 1-2cm de la surface, augmente le debit','Verse au MEME point — un rond blanc apparait et grossit','Quand la tasse est presque pleine : LEVE et coupe a travers le centre'],
   tips:'Le blanc n\'apparait pas ? Pichet trop haut, rapproche-toi. Le motif coule d\'un cote ? Tasse pas assez inclinee au debut.',
   compare:P.heartCup},
  {name:'Rosetta',level:'Intermediaire',icon:'&#127807;',color:'#22c55e',
   photo:P.rosetta,
   video:'E2fPJMkY0_Y',videoTitle:'Rosetta Latte Art Tutorial',videoChannel:'European Coffee Trip',
   steps:['Base : verse HAUT jusqu\'a 50% de la tasse','Descends a 1-2cm a l\'ARRIERE de la tasse, augmente le debit','ZIGZAG rapide du POIGNET (pas du bras !) en avancant vers l\'avant','En arrivant a l\'avant : LEVE et coupe a travers = la tige centrale'],
   tips:'Le zigzag c\'est le POIGNET, pas le bras. Rapide = feuilles fines et nettes. Si c\'est asymetrique = debit pas constant.',
   compare:P.holding},
  {name:'Tulipe',level:'Intermediaire',icon:'&#127799;',color:'#f59e0b',
   photo:P.tulip,
   video:'KqG0C5i5oGc',videoTitle:'Tulip Latte Art Tutorial',videoChannel:'European Coffee Trip',
   steps:['Base : verse HAUT jusqu\'a 40%','Descends et verse un premier ROND blanc puis STOPPE net','Recule un peu et verse un 2eme rond (il pousse le premier vers l\'avant)','Repete 3-5 fois (chaque rond de plus en plus petit), puis coupe a travers'],
   tips:'La PAUSE entre chaque push est essentielle. Si les ronds se melangent = tu ne stoppes pas assez net entre chaque.',
   compare:P.cappuccino},
  {name:'Cygne',level:'Avance',icon:'&#129442;',color:'#a855f7',
   photo:P.barista,
   video:'jYq1pHJYQmw',videoTitle:'Latte Art Basics in Slow Motion',videoChannel:'Dritan Alsela',
   steps:['Base : verse HAUT jusqu\'a 40%','D\'un cote de la tasse : fais une ROSETTA (= l\'aile du cygne)','Tire le lait le long du bord vers le haut (= le cou)','En haut : petit mouvement circulaire (= la tete) puis coupe (= le bec)'],
   tips:'C\'est la combinaison de 3 techniques : rosetta + drag + mini coeur. Maitrise 50+ rosetta propres d\'abord. Patience.',
   compare:P.lattePour}
];

document.getElementById('lattePatterns').innerHTML=patterns.map(p=>`
<div class="lp-card" style="border-top:4px solid ${p.color}">
  <div class="lp-header">
    <img src="${p.photo}" alt="${p.name} latte art" loading="lazy">
    <div>
      <span class="tag" style="background:${p.color}22;color:${p.color}">${p.level}</span>
      <h3 style="font-family:'Playfair Display',serif;font-size:28px;margin:8px 0 4px">${p.icon} ${p.name}</h3>
      <p style="color:var(--text-muted);font-size:14px">Voila a quoi ca doit ressembler. Compare avec tes propres versements.</p>
    </div>
  </div>
  <div class="lp-content">
    <h4 style="margin-bottom:12px;font-size:16px;color:var(--cream)">Etapes :</h4>
    <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;margin-bottom:20px">
      ${p.steps.map((s,i)=>`<div style="background:var(--surface2);border-radius:12px;padding:16px">
        <div style="font-size:24px;font-weight:700;color:${p.color};margin-bottom:4px">${i+1}</div>
        <div style="font-size:13px;color:var(--text-muted);line-height:1.5">${s}</div>
      </div>`).join('')}
    </div>
    <div class="tip-box">&#128161; <strong>${p.tips}</strong></div>
    <h4 style="margin:20px 0 12px;font-size:16px;color:var(--cream)">&#127916; Tutoriel video :</h4>
    <div class="vid-card" style="max-width:560px">
      <iframe src="https://www.youtube.com/embed/${p.video}" allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" allowfullscreen loading="lazy"></iframe>
      <div class="vb"><div class="vt">${p.videoTitle}</div><div class="vd">${p.videoChannel}</div></div>
    </div>
    <h4 style="margin:20px 0 12px;font-size:16px;color:var(--cream)">&#128247; Reference pour comparer :</h4>
    <img src="${p.compare}" alt="Reference ${p.name}" loading="lazy" style="max-width:400px;border-radius:12px">
  </div>
</div>`).join('');

// ===== RECETTES =====
const coffees=[
  {id:1,name:"Espresso",cat:"espresso",origin:"Italie",icon:"\u2615",desc:"Shot concentre, crema doree. La base de tout.",tags:["Intense","Court"],caff:"63mg",temp:"93°C",time:"25-30s",ratio:{espresso:100},ingr:["18g cafe fin","36ml rendement"],steps:["Mouds fin, distribue dans le panier.","Tasse ~15kg de pression, bien droit.","Purge le groupe, lance l'extraction.","25-30s pour 36g. Crema noisette = parfait."]},
  {id:2,name:"Ristretto",cat:"espresso",origin:"Italie",icon:"\u2615",desc:"Hyper concentre, doux, sirupeux.",tags:["Tres intense"],caff:"45mg",temp:"93°C",time:"15-20s",ratio:{espresso:100},ingr:["18g cafe fin","22-27g rendement"],steps:["Meme prep que espresso.","Arrete a 15-20s. Ratio 1:1.5.","Plus doux et aromatique."]},
  {id:3,name:"Lungo",cat:"espresso",origin:"Italie",icon:"\u2615",desc:"Espresso allonge, plus leger.",tags:["Allonge"],caff:"80mg",temp:"93°C",time:"45-60s",ratio:{espresso:100},ingr:["18g cafe","54g rendement"],steps:["Laisse couler plus longtemps.","Ratio 1:3. Attention a l'amertume."]},
  {id:4,name:"Americano",cat:"espresso",origin:"USA",icon:"\u2615",desc:"Espresso + eau chaude.",tags:["Doux","Long"],caff:"63mg",temp:"85°C",time:"3min",ratio:{espresso:20,eau:80},ingr:["1 double espresso","150-200ml eau chaude"],steps:["Tire un double espresso.","Verse l'eau chaude dessus.","Ratio 1:4 a 1:6."]},
  {id:5,name:"Cappuccino",cat:"lait",origin:"Italie",icon:"\u2615",desc:"1/3 espresso, 1/3 lait, 1/3 mousse.",tags:["Cremeux","Mousseux"],caff:"63mg",temp:"65°C",time:"5min",ratio:{espresso:33,lait:33,mousse:34},ingr:["1 double espresso","120ml lait entier"],steps:["Double espresso en tasse 180ml.","Texture : stretching 4-6s + spinning.","Mousse dense (1-1.5cm).","Verse en 3 phases."]},
  {id:6,name:"Latte",cat:"lait",origin:"Italie/USA",icon:"\u2615",desc:"Plus de lait, fine mousse, ideal latte art.",tags:["Doux","Grand"],caff:"63mg",temp:"65°C",time:"5min",ratio:{espresso:15,lait:75,mousse:10},ingr:["1 double espresso","200-250ml lait"],steps:["Double espresso en tasse 300ml.","Micro-mousse fine (0.5cm max).","Verse au centre pour latte art."]},
  {id:7,name:"Flat White",cat:"lait",origin:"Australie",icon:"\u2615",desc:"Latte court, intense, micro-mousse ultra veloutee.",tags:["Veloute"],caff:"126mg",temp:"65°C",time:"5min",ratio:{espresso:25,lait:70,mousse:5},ingr:["1 double ristretto","150ml lait"],steps:["Double ristretto.","Micro-mousse tres fine.","Moins d'1cm de mousse en surface."]},
  {id:8,name:"Macchiato",cat:"lait",origin:"Italie",icon:"\u2615",desc:"Espresso tache d'un nuage de mousse.",tags:["Intense","Court"],caff:"63mg",temp:"65°C",time:"2min",ratio:{espresso:75,mousse:25},ingr:["1 espresso","1 cuillere mousse"],steps:["Espresso en petite tasse.","Depose une cuillere de mousse."]},
  {id:9,name:"Cortado",cat:"lait",origin:"Espagne",icon:"\u2615",desc:"Espresso coupe 50/50 avec lait chaud.",tags:["Equilibre"],caff:"63mg",temp:"65°C",time:"3min",ratio:{espresso:50,lait:50},ingr:["1 double espresso","60ml lait"],steps:["Double espresso en verre Gibraltar.","Lait chaud, peu de mousse.","Ratio 1:1."]},
  {id:10,name:"Mocha",cat:"lait",origin:"USA",icon:"\u2615",desc:"Cafe + chocolat + lait + creme fouettee.",tags:["Chocolat","Gourmand"],caff:"63mg",temp:"65°C",time:"6min",ratio:{espresso:15,chocolat:10,lait:55,creme:20},ingr:["1 double espresso","Sirop/cacao","150ml lait","Creme fouettee"],steps:["Cacao au fond + espresso, melange.","Lait texture par-dessus.","Creme fouettee + cacao."]},
  {id:11,name:"V60",cat:"filtre",origin:"Japon",icon:"\u2615",desc:"Cafe clair et aromatique. Methode douce.",tags:["Delicat"],caff:"95mg",temp:"93°C",time:"3-4min",ratio:{cafe:100},ingr:["15g cafe moyen-fin","250ml eau 93°C","V60"],steps:["Rince le filtre.","Bloom : 30ml, 45 secondes.","Verse en spirale par etapes.","Total 3-4 minutes."]},
  {id:12,name:"Chemex",cat:"filtre",origin:"USA",icon:"\u2615",desc:"Ultra propre et limpide. Filtre epais.",tags:["Propre"],caff:"95mg",temp:"93°C",time:"4-5min",ratio:{cafe:100},ingr:["30g cafe moyen","500ml eau","Chemex"],steps:["Filtre 3 couches vers le bec.","Bloom 60ml, 45s.","Cercles concentriques."]},
  {id:13,name:"French Press",cat:"filtre",origin:"France",icon:"\u2615",desc:"Riche en corps, toutes les huiles preservees.",tags:["Corpose"],caff:"100mg",temp:"93°C",time:"4min",ratio:{cafe:100},ingr:["30g cafe gros","500ml eau"],steps:["Cafe gros + toute l'eau.","Remue a 1 min.","Presse a 4 min.","Sers immediatement."]},
  {id:14,name:"AeroPress",cat:"filtre",origin:"USA",icon:"\u2615",desc:"Portable, polyvalente, cafe doux.",tags:["Portable"],caff:"80mg",temp:"85°C",time:"2min",ratio:{cafe:100},ingr:["15g cafe fin-moyen","200ml eau 85°C"],steps:["Methode inversee.","Cafe + eau + remue 10s.","Attend 1 min, retourne, presse."]},
  {id:15,name:"Cold Brew",cat:"froid",origin:"Japon/USA",icon:"\ud83e\uddca",desc:"Infusion froide 12-24h. Doux, peu acide.",tags:["Froid","Doux"],caff:"200mg",temp:"Froid",time:"12-24h",ratio:{cafe:100},ingr:["100g cafe tres gros","1L eau froide"],steps:["Melange, couvre, frigo.","12-24h. Filtre.","Concentre : dilue 1:1."]},
  {id:16,name:"Iced Latte",cat:"froid",origin:"USA",icon:"\ud83e\uddca",desc:"Espresso sur lait froid et glace.",tags:["Glace"],caff:"63mg",temp:"Froid",time:"3min",ratio:{espresso:15,lait:65,glace:20},ingr:["1 double espresso","200ml lait froid","Glacons"],steps:["Glacons + lait froid.","Espresso verse lentement dessus."]},
  {id:17,name:"Affogato",cat:"froid",origin:"Italie",icon:"\ud83c\udf68",desc:"Espresso brulant sur glace vanille.",tags:["Dessert"],caff:"63mg",temp:"Chaud+froid",time:"2min",ratio:{espresso:40,glace:60},ingr:["1 espresso","1-2 boules glace vanille"],steps:["Glace dans un verre.","Espresso brulant dessus.","Deguste immediatement."]},
  {id:18,name:"Espresso Tonic",cat:"froid",origin:"Scandinavie",icon:"\ud83e\uddca",desc:"Espresso + tonic petillant.",tags:["Petillant"],caff:"63mg",temp:"Froid",time:"3min",ratio:{espresso:25,tonic:60,glace:15},ingr:["1 double espresso","150ml tonic","Glacons"],steps:["Glacons + tonic.","Espresso refroidi 1min verse doucement.","Tranche de citron."]},
  {id:19,name:"Cafe Turc",cat:"monde",origin:"Turquie",icon:"\u2615",desc:"Ultra-fin dans un cezve. Epais, epice.",tags:["Traditionnel"],caff:"50mg",temp:"70°C",time:"5min",ratio:{cafe:100},ingr:["7g cafe ultra-fin","60ml eau","Cezve"],steps:["Eau froide + cafe dans le cezve.","Feu doux. Monte 2 fois.","Ne bois pas le fond."]},
  {id:20,name:"Cafe Vietnamien",cat:"monde",origin:"Vietnam",icon:"\u2615",desc:"Filtre phin + lait concentre sucre.",tags:["Sucre"],caff:"100mg",temp:"96°C",time:"5-7min",ratio:{cafe:30,lait:70},ingr:["15g robusta","Lait concentre","Phin"],steps:["Lait concentre au fond.","Phin + cafe + eau chaude.","5-7 min d'egouttement.","Melange. Glacons pour version froide."]},
  {id:21,name:"Irish Coffee",cat:"monde",origin:"Irlande",icon:"\u2615",desc:"Cafe + whiskey + creme flottante.",tags:["Alcoolise"],caff:"95mg",temp:"80°C",time:"5min",ratio:{cafe:50,whiskey:15,creme:35},ingr:["150ml cafe filtre","40ml whiskey","Creme epaisse"],steps:["Sucre + whiskey + cafe chaud.","Creme flottante sur le dos d'une cuillere.","Bois a travers la creme."]}
];

const catN={espresso:"Espresso",lait:"A base de lait",filtre:"Filtre",froid:"Froid",monde:"Du monde"};
const ratioC={espresso:'#78350f',lait:'#fbbf24',mousse:'#f5f5dc',eau:'#60a5fa',chocolat:'#451a03',creme:'#fef3c7',glace:'#bae6fd',cafe:'#92400e',tonic:'#06b6d4',whiskey:'#b45309'};
let aFilt='all';

function renderR(){
  const cats=['all',...Object.keys(catN)];
  document.getElementById('filterBar').innerHTML=cats.map(c=>`<button class="btn-o" style="${aFilt===c?'background:var(--brown);border-color:var(--brown);color:#000':''}" onclick="aFilt='${c}';renderR()">${c==='all'?'Tous':catN[c]}</button>`).join('');
  const f=aFilt==='all'?coffees:coffees.filter(c=>c.cat===aFilt);
  document.getElementById('recipesGrid').innerHTML=f.map(c=>`
    <div class="rcard" onclick="openR(${c.id})">
      <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px">
        <div style="font-size:32px">${c.icon}</div>
        <div><div style="font-size:11px;color:var(--brown-light);font-weight:600;text-transform:uppercase;letter-spacing:1px">${catN[c.cat]}</div><h4 style="font-family:'Playfair Display',serif;font-size:18px">${c.name}</h4></div>
      </div>
      <p style="font-size:13px;color:var(--text-muted)">${c.desc}</p>
      <div style="margin-top:10px;font-size:12px;color:var(--text-muted)">&#9201; ${c.time} &middot; &#127777; ${c.temp} &middot; &#9889; ${c.caff}</div>
    </div>`).join('');
}

function openR(id){
  const c=coffees.find(x=>x.id===id);if(!c)return;
  let rb='';if(c.ratio)rb='<div class="ratio-bar">'+Object.entries(c.ratio).map(([k,v])=>`<div style="width:${v}%;background:${ratioC[k]||'#888'}">${k} ${v}%</div>`).join('')+'</div>';
  document.getElementById('md').innerHTML=`
    <button class="md-close" onclick="closeM()">&times;</button>
    <div style="font-size:48px;margin-bottom:12px">${c.icon}</div>
    <h2 style="font-family:'Playfair Display',serif;font-size:28px">${c.name}</h2>
    <div style="color:var(--brown-light);font-size:14px;margin-bottom:16px">${c.origin} &middot; ${catN[c.cat]}</div>
    <p style="color:var(--text-muted);font-size:14px">${c.desc}</p>
    <div class="igrid"><div class="ib"><div class="l">Cafeine</div><div class="v">${c.caff}</div></div><div class="ib"><div class="l">Temp</div><div class="v">${c.temp}</div></div><div class="ib"><div class="l">Temps</div><div class="v">${c.time}</div></div></div>
    <h3 style="font-family:'Playfair Display',serif;color:var(--cream);margin:20px 0 8px;font-size:18px">Ratio</h3>${rb}
    <h3 style="font-family:'Playfair Display',serif;color:var(--cream);margin:20px 0 8px;font-size:18px">Ingredients</h3>
    <ul class="ingr">${c.ingr.map(i=>`<li>${i}</li>`).join('')}</ul>
    <h3 style="font-family:'Playfair Display',serif;color:var(--cream);margin:20px 0 8px;font-size:18px">Preparation</h3>
    <div class="steps">${c.steps.map(s=>`<div class="step">${s}</div>`).join('')}</div>`;
  document.getElementById('mo').classList.add('active');document.body.style.overflow='hidden';
}
function closeM(){document.getElementById('mo').classList.remove('active');document.body.style.overflow=''}
document.getElementById('mo').addEventListener('click',e=>{if(e.target===e.currentTarget)closeM()});
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeM()});
renderR();

// ===== DIAGNOSTIC =====
document.getElementById('diagVisual').innerHTML=`
<div class="photo-compare">
  <div class="pc-card" style="border:2px solid #ef4444">
    <img src="${P.machine}" alt="Sous-extraction" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-bad">Acide / Aigre</div>
      <h4>Sous-extraction</h4>
      <p>&#8226; Mouture plus fine<br>&#8226; Temperature plus haute<br>&#8226; Temps plus long</p>
    </div>
  </div>
  <div class="pc-card" style="border:2px solid #22c55e">
    <img src="${P.drip}" alt="Extraction parfaite" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-good">Equilibre</div>
      <h4>Extraction parfaite</h4>
      <p>&#8226; Crema noisette, tiger stripes<br>&#8226; Gout sucre, rond, complexe</p>
    </div>
  </div>
  <div class="pc-card" style="border:2px solid #f59e0b">
    <img src="${P.latte}" alt="Sur-extraction" loading="lazy">
    <div class="pc-body">
      <div class="vcard-status st-warn">Amer / Sec</div>
      <h4>Sur-extraction</h4>
      <p>&#8226; Mouture plus grosse<br>&#8226; Temperature plus basse<br>&#8226; Temps plus court</p>
    </div>
  </div>
</div>`;

const troubles=[
  {q:'Pas de crema / crema pale',a:'<strong>Cafe trop vieux</strong> (>3-4 semaines) ou <strong>mouture trop grosse</strong>. Utilise du cafe frais (<2 semaines apres torrefaction), affine la mouture.'},
  {q:'Channeling (eau passe d\'un cote)',a:'<strong>Distribution inegale.</strong> Utilise un outil WDT (aiguille). Tasse DROIT. Ne tape pas le porte-filtre apres tassage.'},
  {q:'Mon cafe filtre est amer',a:'<strong>Mouture trop fine</strong> ou eau trop chaude. Grossis la mouture, vise 92-94°C.'},
  {q:'Le latte art ne marche pas du tout',a:'1. <strong>Mousse pas assez bonne</strong> → retexture. 2. <strong>Blanc n\'apparait pas</strong> → pichet trop haut, rapproche-toi. 3. <strong>Motif coule</strong> → mousse trop liquide.'},
  {q:'Le lait vegetal caille dans le cafe',a:'Le cafe est <strong>trop acide ou trop chaud</strong>. Utilise des versions "Barista" (Oatly, Minor Figures). Verse lait SUR cafe, pas l\'inverse.'},
  {q:'La machine ne fait pas de pression',a:'<strong>Detartre la machine.</strong> Verifie les joints. Si neuve : laisse chauffer 15-20 min avant le premier shot.'},
  {q:'Mon lait fait des grosses bulles',a:'<strong>Buse trop haute.</strong> Elle doit etre JUSTE sous la surface, pas au-dessus. Ecoute le son "tch-tch" regulier, pas des "SPLASH".'},
  {q:'Mon shot est trop acide',a:'<strong>Sous-extraction.</strong> Solutions dans l\'ordre : 1. Mouture plus fine (1 cran). 2. Si toujours acide : augmente la dose (19g au lieu de 18g). 3. Augmente la temperature.'}
];
document.getElementById('troubleshoot').innerHTML=troubles.map(t=>`<div class="diag"><div class="diag-h" onclick="this.parentElement.classList.toggle('open')"><span>${t.q}</span><span class="arr">&#9660;</span></div><div class="diag-b"><div class="diag-bi">${t.a}</div></div></div>`).join('');

// ===== OUTILS =====
let tI=null,tMs=0,tR=false;
document.getElementById('toolsContent').innerHTML=`
<div class="tbox"><h3>&#9201; Timer d'extraction</h3><div class="timer-d" id="tD">00:00.0</div><div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap"><button class="btn" onclick="tT()" id="tB">Demarrer</button><button class="btn-o" onclick="tReset()">Reset</button></div><div style="display:flex;gap:8px;justify-content:center;margin-top:12px;flex-wrap:wrap"><button class="btn-o" onclick="tP(25)">25s Espresso</button><button class="btn-o" onclick="tP(240)">4min French Press</button><button class="btn-o" onclick="tP(210)">3:30 V60</button></div></div>
<div class="tbox"><h3>&#128200; Calculateur de ratio</h3><div class="irow"><div><div class="ilabel">Dose (g)</div><input type="number" class="ifield" id="cD" value="18" oninput="cR()"></div><div><div class="ilabel">Ratio</div><select class="ifield" id="cRat" style="width:150px" onchange="cR()"><option value="1.5">1:1.5 Ristretto</option><option value="2" selected>1:2 Espresso</option><option value="2.5">1:2.5 Lungo</option><option value="15">1:15 Filtre fort</option><option value="16">1:16 Filtre</option></select></div></div><div class="rbox"><div class="big" id="cRes">36g</div><div class="lbl" id="cLbl">Rendement cible</div></div></div>
<div class="tbox"><h3>&#9989; Checklist ouverture</h3><ul class="cklist" id="ckO"></ul><h3 style="margin-top:24px">&#128308; Checklist fermeture</h3><ul class="cklist" id="ckC"></ul></div>
<div class="tbox"><h3>&#128221; Carnet de notes</h3><textarea class="notes-a" id="nA" placeholder="Ex: Ethiopie Yirgacheffe — Moulin cran 12 — 18g → 36g en 27s — floral, agrumes...">${localStorage.getItem('bn')||''}</textarea><div style="margin-top:12px;display:flex;gap:8px"><button class="btn" onclick="localStorage.setItem('bn',document.getElementById('nA').value);this.textContent='&#10003; Sauvegarde !';setTimeout(()=>this.textContent='Sauvegarder',1500)">Sauvegarder</button><button class="btn-o" onclick="if(confirm('Effacer ?')){document.getElementById('nA').value='';localStorage.removeItem('bn')}">Effacer</button></div></div>`;

function tT(){if(tR){clearInterval(tI);tR=false;document.getElementById('tB').textContent='Reprendre'}else{tR=true;document.getElementById('tB').textContent='Pause';const s=Date.now()-tMs;tI=setInterval(()=>{tMs=Date.now()-s;document.getElementById('tD').textContent=fT(tMs)},100)}}
function tReset(){clearInterval(tI);tMs=0;tR=false;document.getElementById('tD').textContent='00:00.0';document.getElementById('tB').textContent='Demarrer'}
function tP(s){tReset();document.getElementById('tD').textContent='00:00.0 / '+fT(s*1000)}
function fT(ms){const s=Math.floor(ms/1000),m=Math.floor(s/60),ss=s%60,d=Math.floor((ms%1000)/100);return String(m).padStart(2,'0')+':'+String(ss).padStart(2,'0')+'.'+d}
function cR(){const d=parseFloat(document.getElementById('cD').value)||18,r=parseFloat(document.getElementById('cRat').value)||2;document.getElementById('cRes').textContent=Math.round(d*r)+'g';document.getElementById('cLbl').textContent=r>=10?`${Math.round(d*r)}ml d'eau pour ${d}g`:`Vise ${Math.round(d*r)}g en tasse`}
cR();

const ckO=['Allumer la machine (15-20 min chauffe)','Purger le groupe','Nettoyer porte-filtre','Moudre + jeter 2-3 premieres doses','Tirer un espresso test','Ajuster mouture si besoin','Sortir les laits','Remplir sirops/sucre/cacao','Verifier stocks gobelets'];
const ckC=['Backflush avec detergent','Nettoyer groupes + porte-filtres','Vider bac a marc','Purger + nettoyer buse vapeur','Brosser le moulin','Vider les laits','Nettoyer pichets','Essuyer surfaces','Eteindre machine'];
function rCk(items,cid,key){const sv=JSON.parse(localStorage.getItem(key)||'[]');document.getElementById(cid).innerHTML=items.map((it,i)=>`<li class="${sv.includes(i)?'done':''}" onclick="tCk(${i},'${key}','${cid}')"><div class="ckbox">${sv.includes(i)?'&#10003;':''}</div>${it}</li>`).join('')}
function tCk(i,k,cid){let sv=JSON.parse(localStorage.getItem(k)||'[]');if(sv.includes(i))sv=sv.filter(x=>x!==i);else sv.push(i);localStorage.setItem(k,JSON.stringify(sv));const items=cid==='ckO'?ckO:ckC;rCk(items,cid,k)}
rCk(ckO,'ckO','co');rCk(ckC,'ckC','cc');

// ===== GLOSSAIRE =====
const gl=[
  {t:'Backflush',d:'Nettoyage du groupe avec disque aveugle + detergent. Quotidien.'},
  {t:'Bloom',d:'Pre-infusion en filtre. L\'eau fait degazer le CO2 du cafe frais.'},
  {t:'Channeling',d:'Passage preferentiel de l\'eau causant une extraction inegale.'},
  {t:'Crema',d:'Mousse doree sur l\'espresso. CO2 + huiles + proteines.'},
  {t:'Dialing-in',d:'Ajuster mouture/dose/temps pour le shot parfait.'},
  {t:'WDT',d:'Weiss Distribution Technique. Aiguille pour casser les grumeaux.'},
  {t:'Dose',d:'Poids de cafe sec en grammes.'},
  {t:'Extraction',d:'Dissolution des solubles du cafe par l\'eau. Ideal : 18-22%.'},
  {t:'Micro-mousse',d:'Lait texture avec bulles microscopiques. Texture veloutee.'},
  {t:'Porte-filtre',d:'Le manche avec panier qui se verrouille dans le groupe.'},
  {t:'Purge',d:'Couler l\'eau du groupe avant extraction pour stabiliser la temperature.'},
  {t:'Ratio',d:'Rapport dose/rendement. 1:2 = 18g cafe → 36g liquide.'},
  {t:'Ristretto',d:'Shot court ratio 1:1.5. Plus concentre et doux.'},
  {t:'Stretching',d:'Phase du texturage : incorporation d\'air (le "tch-tch").'},
  {t:'Spinning',d:'Phase du texturage : vortex pour integrer les bulles.'},
  {t:'Tamp',d:'Tassage du cafe dans le panier. ~15kg, uniforme.'},
  {t:'TDS',d:'Total Dissolved Solids. Concentration du cafe.'},
  {t:'Tiger striping',d:'Rayures dans la crema. Signe d\'une bonne extraction.'},
  {t:'Torrefaction',d:'Claire=fruite. Moyenne=equilibre. Foncee=chocolat/amer.'},
  {t:'Single Origin',d:'Cafe d\'une seule ferme/region. Terroir unique.'},
  {t:'Specialty',d:'Cafe note 80+/100 par la SCA.'}
];
document.getElementById('glossContent').innerHTML=gl.map(g=>`<dl class="gl-item"><dt>${g.t}</dt><dd>${g.d}</dd></dl>`).join('');

// Smooth scroll
document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener('click',e=>{e.preventDefault();const el=document.querySelector(a.getAttribute('href'));if(el)el.scrollIntoView({behavior:'smooth'})})});
</script>
</body>
</html>
